## 命令模式 Command Pattern

### 概述

发送者和接收者之间引入新的命令对象，将发送者的请求封装在命令对象中，再通过命令对象来调用接收者的方法，从而实现请求发送者和接收者之间的完全解耦。

### 定义

命令模式是将一个请求封装为一个对象，从而让我们可以使用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作。

命令模式是一种对象行为型模式，又称为动作模式、事务模式。

命令模式的本质是对请求进行封装，一个请求对应一个命令。

### 角色

1.Command:抽象命令类，声明执行请求的execute()等方法，通过这些方法可以调用请求接收者的相关操作。
```java
abstract class Command{
    public abstract void execute();
}
```
2.ConcreteCommand:具体命令类，抽象命令类的子类，对应具体的接收者对象，绑定接收者对象的动作。
```java
class ConcreteCommand extends Command{
    private Receiver receiver;//维持对一个请求接收者对象的引用
    public void execute(){
        receiver.action();//调用请求接收者的业务处理方法
    }
}
```
3.Invoker:请求发送者，通过命令对象来执行请求，与抽象命令类存在联系。
```java
class Invoker{
    private Command command;
    //构造注入:运行时传入具体命令类对象
    public Invoker(Command command){
        this.command = command;
    }
    //设值注入:运行时传入具体命令类对象
    public void setCommand(Command command){
        this.command = command;
    }
    public void call(){
        command.execute();
    }
}
```
4.Receiver:请求接收者，具体实现对请求的业务处理。
```java
class Receiver{
    public void action(){/*具体操作*/}
}
```
### 功能

1.使用不同请求对客户进行参数化：

向请求发送者注入不同的具体命令对象，使得相同的发送者发送请求给不同的接收者。

2.请求排队：

当请求发送者发送请求时，可能有多个请求接收者产生响应，这些请求接收者将逐个执行业务方法，完成对请求的处理，需要用到命令队列。

此时请求发送者将针对CommandQueue编程。
```java
class CommandQueue{
    //定义列表存储命令
    private ArrayList<Command> commands = new ArrayList<Command>();
    public void addCommand(Command command){
        commands.add(command);
    }
    public void removeCommand(Command command){
        commands.remove(command);
    }
    //循环调用每一个命令对象的execute()方法
    public void execute(){
        for(Command command : commands)
           command.execute();
    }
}
class Invoker{
    private CommandQueue commandQueue;
    //构造注入
    public Invoker(CommandQueue commandQueue){
        this.commandQueue = commandQueue;
    }
    //设值注入
    public void setCommandQueue(CommandQueue commandQueue){
        this.commandQueue = commandQueue;
    }
    public void call(){
        commandQueue.execute();
    }
}
```
3.撤销操作：

可以在具体命令类里定义撤销undo()和恢复redo()方法。